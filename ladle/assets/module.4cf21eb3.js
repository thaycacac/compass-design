import{r as b,R as T}from"./index.c85b1806.js";import{c as g,d as _,e as O,f as k,g as B,h as W,i as K,j,k as q,a as M,l as z}from"./module.aab4c89e.js";function I(e){if(_()==="virtual"){let t=document.activeElement;O(()=>{document.activeElement===t&&document.contains(e)&&k(e)})}else k(e)}function H(e){if(!(e instanceof HTMLElement)&&!(e instanceof SVGElement))return!1;let{display:t,visibility:r}=e.style,o=t!=="none"&&r!=="hidden"&&r!=="collapse";if(o){const{getComputedStyle:i}=e.ownerDocument.defaultView;let{display:n,visibility:u}=i(e);o=n!=="none"&&u!=="hidden"&&u!=="collapse"}return o}function U(e,t){return!e.hasAttribute("hidden")&&(e.nodeName==="DETAILS"&&t&&t.nodeName!=="SUMMARY"?e.hasAttribute("open"):!0)}function V(e,t){return e.nodeName!=="#comment"&&H(e)&&U(e,t)&&(!e.parentElement||V(e.parentElement,e))}const P=T.createContext(null);let d=null;function ie(e){let{children:t,contain:r,restoreFocus:o,autoFocus:i}=e,n=b.exports.useRef(),u=b.exports.useRef(),a=b.exports.useRef([]),c=b.exports.useContext(P);var s;let l=(s=c==null?void 0:c.scopeRef)!==null&&s!==void 0?s:null,$=b.exports.useMemo(()=>d&&f.getTreeNode(d)&&!w(d,l)?d:l,[l]);g(()=>{let v=n.current.nextSibling,R=[];for(;v&&v!==u.current;)R.push(v),v=v.nextSibling;a.current=R},[t,$]),f.getTreeNode($)&&!f.getTreeNode(a)&&f.addTreeNode(a,$);let h=f.getTreeNode(a);h.contain=r,Z(a,o,r),Q(a,r),te(a,o,r),X(a,i),g(()=>{if(a)return()=>{let v=f.getTreeNode(a).parent.scopeRef;(a===d||w(a,d))&&(!v||f.getTreeNode(v))&&(d=v),f.removeTreeNode(a)}},[a,$]);let N=G(a);return T.createElement(P.Provider,{value:{scopeRef:a,focusManager:N}},T.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:n}),t,T.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:u}))}function G(e){return{focusNext(t={}){let r=e.current,{from:o,tabbable:i,wrap:n,accept:u}=t,a=o||document.activeElement,c=r[0].previousElementSibling,s=E(x(r),{tabbable:i,accept:u},r);s.currentNode=p(a,r)?a:c;let l=s.nextNode();return!l&&n&&(s.currentNode=c,l=s.nextNode()),l&&m(l,!0),l},focusPrevious(t={}){let r=e.current,{from:o,tabbable:i,wrap:n,accept:u}=t,a=o||document.activeElement,c=r[r.length-1].nextElementSibling,s=E(x(r),{tabbable:i,accept:u},r);s.currentNode=p(a,r)?a:c;let l=s.previousNode();return!l&&n&&(s.currentNode=c,l=s.previousNode()),l&&m(l,!0),l},focusFirst(t={}){let r=e.current,{tabbable:o,accept:i}=t,n=E(x(r),{tabbable:o,accept:i},r);n.currentNode=r[0].previousElementSibling;let u=n.nextNode();return u&&m(u,!0),u},focusLast(t={}){let r=e.current,{tabbable:o,accept:i}=t,n=E(x(r),{tabbable:o,accept:i},r);n.currentNode=r[r.length-1].nextElementSibling;let u=n.previousNode();return u&&m(u,!0),u}}}const L=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],J=L.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";L.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const Y=L.join(':not([hidden]):not([tabindex="-1"]),');function x(e){return e[0].parentElement}function F(e){let t=f.getTreeNode(d);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function Q(e,t){let r=b.exports.useRef(),o=b.exports.useRef(null);g(()=>{let i=e.current;if(!t){o.current&&(cancelAnimationFrame(o.current),o.current=null);return}let n=c=>{if(c.key!=="Tab"||c.altKey||c.ctrlKey||c.metaKey||!F(e))return;let s=document.activeElement,l=e.current;if(!p(s,l))return;let $=E(x(l),{tabbable:!0},l);$.currentNode=s;let h=c.shiftKey?$.previousNode():$.nextNode();h||($.currentNode=c.shiftKey?l[l.length-1].nextElementSibling:l[0].previousElementSibling,h=c.shiftKey?$.previousNode():$.nextNode()),c.preventDefault(),h&&m(h,!0)},u=c=>{(!d||w(d,e))&&p(c.target,e.current)?(d=e,r.current=c.target):F(e)&&!y(c.target,e)?r.current?r.current.focus():d&&S(d.current):F(e)&&(r.current=c.target)},a=c=>{o.current=requestAnimationFrame(()=>{F(e)&&!y(document.activeElement,e)&&(d=e,document.body.contains(c.target)?(r.current=c.target,r.current.focus()):d&&S(d.current))})};return document.addEventListener("keydown",n,!1),document.addEventListener("focusin",u,!1),i.forEach(c=>c.addEventListener("focusin",u,!1)),i.forEach(c=>c.addEventListener("focusout",a,!1)),()=>{document.removeEventListener("keydown",n,!1),document.removeEventListener("focusin",u,!1),i.forEach(c=>c.removeEventListener("focusin",u,!1)),i.forEach(c=>c.removeEventListener("focusout",a,!1))}},[e,t]),b.exports.useEffect(()=>()=>{o.current&&cancelAnimationFrame(o.current)},[o])}function D(e){return y(e)}function p(e,t){return t.some(r=>r.contains(e))}function y(e,t=null){for(let{scopeRef:r}of f.traverse(f.getTreeNode(t)))if(p(e,r.current))return!0;return!1}function ue(e){return y(e,d)}function w(e,t){var r;let o=(r=f.getTreeNode(t))===null||r===void 0?void 0:r.parent;for(;o;){if(o.scopeRef===e)return!0;o=o.parent}return!1}function m(e,t=!1){if(e!=null&&!t)try{I(e)}catch{}else if(e!=null)try{e.focus()}catch{}}function S(e,t=!0){let r=e[0].previousElementSibling,o=E(x(e),{tabbable:t},e);o.currentNode=r;let i=o.nextNode();t&&!i&&(o=E(x(e),{tabbable:!1},e),o.currentNode=r,i=o.nextNode()),m(i)}function X(e,t){const r=T.useRef(t);b.exports.useEffect(()=>{r.current&&(d=e,p(document.activeElement,d.current)||S(e.current)),r.current=!1},[e])}function Z(e,t,r){g(()=>{if(t||r)return;let o=e.current,i=n=>{let u=n.target;p(u,e.current)?d=e:D(u)||(d=null)};return document.addEventListener("focusin",i,!1),o.forEach(n=>n.addEventListener("focusin",i,!1)),()=>{document.removeEventListener("focusin",i,!1),o.forEach(n=>n.removeEventListener("focusin",i,!1))}},[e,t,r])}function ee(e){let t=f.getTreeNode(d);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(t==null?void 0:t.scopeRef)===e}function te(e,t,r){const o=b.exports.useRef(typeof document<"u"?document.activeElement:null);g(()=>{let i=e.current;if(!t||r)return;let n=()=>{(!d||w(d,e))&&(d=e)};return document.addEventListener("focusin",n,!1),i.forEach(u=>u.addEventListener("focusin",n,!1)),()=>{document.removeEventListener("focusin",n,!1),i.forEach(u=>u.removeEventListener("focusin",n,!1))}},[e,r]),g(()=>{if(!t)return;f.getTreeNode(e).nodeToRestore=o.current;let i=n=>{if(n.key!=="Tab"||n.altKey||n.ctrlKey||n.metaKey)return;let u=document.activeElement;if(!p(u,e.current))return;let a=f.getTreeNode(e).nodeToRestore,c=E(document.body,{tabbable:!0});c.currentNode=u;let s=n.shiftKey?c.previousNode():c.nextNode();if((!document.body.contains(a)||a===document.body)&&(a=null,f.getTreeNode(e).nodeToRestore=null),(!s||!p(s,e.current))&&a){c.currentNode=a;do s=n.shiftKey?c.previousNode():c.nextNode();while(p(s,e.current));n.preventDefault(),n.stopPropagation(),s?m(s,!0):D(a)?m(a,!0):u.blur()}};return r||document.addEventListener("keydown",i,!0),()=>{r||document.removeEventListener("keydown",i,!0);let n=f.getTreeNode(e).nodeToRestore;if(t&&n&&(p(document.activeElement,e.current)||document.activeElement===document.body&&ee(e))){let u=f.clone();requestAnimationFrame(()=>{if(document.activeElement===document.body){let a=u.getTreeNode(e);for(;a;){if(a.nodeToRestore&&document.body.contains(a.nodeToRestore)){m(a.nodeToRestore);return}a=a.parent}for(a=u.getTreeNode(e);a;){if(a.scopeRef&&f.getTreeNode(a.scopeRef)){S(a.scopeRef.current,!0);return}a=a.parent}}})}}},[e,t,r])}function E(e,t,r){let o=t!=null&&t.tabbable?Y:J,i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(n){var u;return!(t==null||(u=t.from)===null||u===void 0)&&u.contains(n)?NodeFilter.FILTER_REJECT:n.matches(o)&&V(n)&&(!r||p(n,r))&&(!(t!=null&&t.accept)||t.accept(n))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t!=null&&t.from&&(i.currentNode=t.from),i}class C{get size(){return this.fastMap.size}getTreeNode(t){return this.fastMap.get(t)}addTreeNode(t,r,o){let i=this.fastMap.get(r!=null?r:null),n=new A({scopeRef:t});i.addChild(n),n.parent=i,this.fastMap.set(t,n),o&&(n.nodeToRestore=o)}removeTreeNode(t){if(t===null)return;let r=this.fastMap.get(t),o=r.parent;for(let n of this.traverse())n!==r&&r.nodeToRestore&&n.nodeToRestore&&r.scopeRef.current&&p(n.nodeToRestore,r.scopeRef.current)&&(n.nodeToRestore=r.nodeToRestore);let i=r.children;o.removeChild(r),i.length>0&&i.forEach(n=>o.addChild(n)),this.fastMap.delete(r.scopeRef)}*traverse(t=this.root){if(t.scopeRef!=null&&(yield t),t.children.length>0)for(let r of t.children)yield*this.traverse(r)}clone(){let t=new C;for(let r of this.traverse())t.addTreeNode(r.scopeRef,r.parent.scopeRef,r.nodeToRestore);return t}constructor(){this.fastMap=new Map,this.root=new A({scopeRef:null}),this.fastMap.set(null,this.root)}}class A{addChild(t){this.children.push(t),t.parent=this}removeChild(t){this.children.splice(this.children.indexOf(t),1),t.parent=void 0}constructor(t){this.children=[],this.contain=!1,this.scopeRef=t.scopeRef}}let f=new C;function ce(e={}){let{autoFocus:t=!1,isTextInput:r,within:o}=e,i=b.exports.useRef({isFocused:!1,isFocusVisible:t||B()}),[n,u]=b.exports.useState(!1),[a,c]=b.exports.useState(()=>i.current.isFocused&&i.current.isFocusVisible),s=b.exports.useCallback(()=>c(i.current.isFocused&&i.current.isFocusVisible),[]),l=b.exports.useCallback(N=>{i.current.isFocused=N,u(N),s()},[s]);W(N=>{i.current.isFocusVisible=N,s()},[],{isTextInput:r});let{focusProps:$}=K({isDisabled:o,onFocusChange:l}),{focusWithinProps:h}=j({isDisabled:!o,onFocusWithinChange:l});return{isFocused:n,isFocusVisible:i.current.isFocused&&a,focusProps:o?h:$}}let re=T.createContext(null);function ne(e){let t=b.exports.useContext(re)||{};z(t,e);let{ref:r,...o}=t;return o}function se(e,t){let{focusProps:r}=K(e),{keyboardProps:o}=q(e),i=M(r,o),n=ne(t),u=e.isDisabled?{}:n,a=b.exports.useRef(e.autoFocus);return b.exports.useEffect(()=>{a.current&&t.current&&I(t.current),a.current=!1},[t]),{focusableProps:M({...i,tabIndex:e.excludeFromTabOrder&&!e.isDisabled?-1:void 0},u)}}export{se as $,ie as a,I as b,ue as c,E as d,ce as e};
